# ChromaDB使用ガイド

> **📋 ステータス**: アクティブ（実用ガイド）  
> **📅 最終更新**: 2025-12-12  
> **👤 用途**: ChromaDBのセットアップ、動作確認、トラブルシューティングの包括ガイド

## 📋 目次

1. [前提条件の確認](#前提条件の確認)
2. [アプリケーションの起動](#アプリケーションの起動)
3. [ChromaDB Serverの起動確認](#chromadb-serverの起動確認)
4. [ChromaDBの設定](#chromadbの設定)
5. [動作確認手順](#動作確認手順)
6. [テストページでの動作確認](#テストページでの動作確認)
7. [トラブルシューティング](#トラブルシューティング)
8. [パフォーマンス確認](#パフォーマンス確認)
9. [確認項目チェックリスト](#確認項目チェックリスト)

---

## 📋 前提条件の確認

### 1. Python環境の確認

```bash
# Python 3.8以上がインストールされているか確認
python3 --version  # Python 3.8-3.12が必要
```

**必要なバージョン**: Python 3.8-3.12

### 2. ChromaDBのインストール確認

```bash
# ChromaDBがインストールされているか確認
python3 -c "import chromadb; print(chromadb.__version__)"
```

**ChromaDBがインストールされていない場合**:
```bash
pip3 install chromadb
```

---

## 🚀 アプリケーションの起動

```bash
cd /Users/gaikondo/Desktop/test-app/MissionAI
npm run tauri dev
```

---

## ChromaDB Serverの起動確認

アプリケーション起動時に、コンソール（ターミナル）に以下のメッセージが表示されることを確認：

### ✅ 成功時のメッセージ

```
🚀 ChromaDB Serverの起動を開始します...
   データディレクトリ: /path/to/chromadb
   ポート: 8000
   Pythonパス: python3
   Python環境を検出: python3 (Python 3.12.x)
   ChromaDBバージョン: x.x.x
   ChromaDB Serverプロセスを起動しました (PID: xxxx)
   ChromaDB Serverの起動を待機中...
   ✅ ChromaDB Serverが正常に起動しました (x秒後)
   ✅ ChromaDBクライアントを初期化しました
```

### ❌ エラー時の対処

| エラーメッセージ | 対処法 |
|----------------|--------|
| `Python環境が見つかりません` | Python 3.8以上をインストール |
| `ChromaDBがインストールされていません` | `pip3 install chromadb`を実行 |
| `ChromaDB Serverの起動確認に失敗しました` | ポート8000が使用中か確認 |

**ポート8000の使用状況確認**:
```bash
# Mac/Linux
lsof -i :8000

# Windows
netstat -ano | findstr :8000
```

---

## ChromaDBの設定

**重要**: ChromaDBは常に有効です。設定画面での選択は不要です。

アプリケーション起動時に自動的にChromaDB Serverが起動し、埋め込みデータの保存・検索に使用されます。

**確認ポイント**:
- ✅ アプリケーション起動時にChromaDB Serverが正常に起動する
- ✅ 埋め込みデータがChromaDBに保存される
- ✅ 検索がChromaDB経由で実行される

---

## 動作確認手順

### ステップ1: エンティティの作成と自動保存確認

1. 組織ページ（`/organization/[id]`）に移動
2. 新しいエンティティを作成（例: 「テストエンティティ」）
3. ブラウザの開発者ツール（F12）でコンソールを開く
4. 以下のログが表示されることを確認：

**✅ 成功時のログ:**
```
✅ ChromaDBにエンティティ埋め込みを保存しました: [entity-id]
```

**❌ エラー時の確認:**
- ChromaDB Serverが起動しているか確認
- エラーメッセージの内容を確認
- ChromaDB Serverのログを確認

### ステップ2: リレーションの作成と自動保存確認

1. 会議ノートページでリレーションを作成
2. ブラウザの開発者ツール（F12）でコンソールを開く
3. 以下のログが表示されることを確認：

**✅ 成功時のログ:**
```
✅ ChromaDBにリレーション埋め込みを保存しました: [relation-id]
```

### ステップ3: トピックの作成と自動保存確認

1. 会議ノートページでトピックを作成
2. ブラウザの開発者ツール（F12）でコンソールを開く
3. 以下のログが表示されることを確認：

**✅ 成功時のログ:**
```
✅ ChromaDBにトピック埋め込みを保存しました: [topic-id]
```

### ステップ4: RAG検索ページでの動作確認

1. RAG検索ページ（`/rag-search`）に移動
2. 検索クエリを入力（例: 「テストエンティティ」）
3. 検索を実行
4. ブラウザの開発者ツール（F12）でコンソールを開く
5. ChromaDBが使用されていることを確認

**確認ポイント**:
- ✅ 検索結果が表示される
- ✅ コンソールにChromaDB関連のログが表示される（エラーがない）
- ✅ 検索速度が速い（大量データの場合）

---

## テストページでの動作確認

1. ChromaDBテストページ（`/test-chromadb`）に移動
2. 「テストを実行」ボタンをクリック
3. すべてのテストが成功することを確認

**テスト項目:**
- ✅ エンティティ埋め込みの保存
- ✅ エンティティ検索
- ✅ リレーション埋め込みの保存
- ✅ リレーション検索
- ✅ トピック埋め込みの保存
- ✅ トピック検索

**✅ 成功時のログ:**
```
🧪 ChromaDBの動作確認を開始します...
📦 ステップ1: テスト用のエンティティ埋め込みを保存
✅ エンティティ埋め込みの保存に成功しました
📦 ステップ2: 類似エンティティの検索
✅ 検索に成功しました。結果数: X
...
✅ すべてのテストが完了しました！
```

---

## 🔍 トラブルシューティング

### ChromaDB Serverが起動しない

#### エラーメッセージ: `Python環境が見つかりません`

**対処法**:
```bash
# Pythonのパスを確認
which python3

# Python 3.8以上がインストールされているか確認
python3 --version
```

#### エラーメッセージ: `ChromaDBがインストールされていません`

**対処法**:
```bash
# ChromaDBをインストール
pip3 install chromadb

# インストール確認
python3 -c "import chromadb; print(chromadb.__version__)"
```

#### エラーメッセージ: `ChromaDB Serverの起動確認に失敗しました`

**対処法**:
1. ポート8000が使用されていないか確認
   ```bash
   lsof -i :8000  # Mac/Linux
   netstat -ano | findstr :8000  # Windows
   ```
2. ChromaDB Serverのログを確認
3. アプリケーションを再起動

### 埋め込みの保存に失敗する場合

#### エラーメッセージ: `ChromaDBクライアントが初期化されていません`

**対処法**:
1. ChromaDB Serverが正常に起動しているか確認
2. アプリケーションを再起動
3. ChromaDB Serverの起動ログを確認

#### エラーメッセージ: `コレクションの取得/作成に失敗しました`

**対処法**:
1. ChromaDB Serverのログを確認
2. データディレクトリの権限を確認
3. アプリケーションを再起動

### エンティティ/リレーション/トピックが保存されない

**確認事項**:
1. **ChromaDB Serverの起動確認**
   - ターミナルに「✅ ChromaDB Serverが正常に起動しました」が表示されているか確認
   - ChromaDB Serverのプロセスが実行中か確認

2. **コンソールエラーの確認**
   - ブラウザの開発者ツール（F12）でエラーメッセージを確認
   - ChromaDB関連のエラーがないか確認

### 検索結果が表示されない

**確認事項**:
1. **データの保存確認**
   - エンティティ/リレーション/トピックがChromaDBに保存されているか確認
   - コンソールに「✅ ChromaDBに...保存しました」のログが表示されているか確認

2. **組織IDの確認**
   - 検索時に正しい組織IDが指定されているか確認
   - エンティティ・リレーション・トピック検索では`organizationId`が必要

3. **埋め込み生成の確認**
   - OpenAI APIキーが設定されているか確認
   - 埋め込み生成が成功しているか確認

#### エラーメッセージ: `類似エンティティの検索に失敗しました`

**対処法**:
1. ChromaDB Serverが正常に動作しているか確認
2. 埋め込みが正常に保存されているか確認
3. アプリケーションを再起動

---

## 📊 パフォーマンス確認

### 大量データでの検索速度

1. 10,000件以上のエンティティ/リレーション/トピックを作成
2. RAG検索ページで検索を実行
3. 検索速度を確認

**期待される結果**:
- **SQLite**: 数秒〜数十秒
- **ChromaDB**: 1秒以下（大幅な速度向上）

---

## ✅ 確認項目チェックリスト

### 前提条件
- [ ] Python 3.8以上がインストールされている
- [ ] ChromaDBがインストールされている

### 起動確認
- [ ] アプリケーション起動時にChromaDB Serverが正常に起動する
- [ ] ターミナルに成功メッセージが表示される

### 設定確認
- [ ] ChromaDBが常に有効であることを確認（設定画面での選択は不要）

### 動作確認
- [ ] エンティティ作成時にChromaDBに自動保存される
- [ ] リレーション作成時にChromaDBに自動保存される
- [ ] トピック作成時にChromaDBに自動保存される
- [ ] RAG検索ページでChromaDBが使用される
- [ ] 検索結果が正しく表示される

### テスト確認
- [ ] テストページですべてのテストが成功する
- [ ] エンティティ埋め込みの保存テストが成功
- [ ] エンティティ検索テストが成功
- [ ] リレーション埋め込みの保存テストが成功
- [ ] リレーション検索テストが成功
- [ ] トピック埋め込みの保存テストが成功
- [ ] トピック検索テストが成功

### エラー確認
- [ ] エラーが発生しない
- [ ] コンソールにエラーメッセージが表示されない

### パフォーマンス確認
- [ ] 大量データでの検索速度が向上している

---

## 🎯 次のステップ

動作確認が完了したら：

1. **実際のデータでテスト**
   - 実際の業務データでChromaDBの動作を確認

2. **パフォーマンステスト**
   - 大量データでの検索速度を測定
   - SQLiteとの比較

3. **配布時の設定**
   - Python環境のバンドル設定
   - ChromaDB Serverの起動設定

---

## 📚 関連ドキュメント

- [`CHROMADB_INTEGRATION_PLAN.md`](./CHROMADB_INTEGRATION_PLAN.md) - ChromaDB統合の実装計画
- [`CHROMADB_SQLITE_RELATIONSHIP.md`](./CHROMADB_SQLITE_RELATIONSHIP.md) - ChromaDBとSQLiteの関係
- [`CHROMADB_SEARCH_CONDITIONS.md`](./CHROMADB_SEARCH_CONDITIONS.md) - 検索条件と動作
- [`CHROMADB_LOCAL_USAGE.md`](./CHROMADB_LOCAL_USAGE.md) - ローカル利用方法の技術的説明
