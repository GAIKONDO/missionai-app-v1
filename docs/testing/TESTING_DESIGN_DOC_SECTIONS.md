# システム設計ドキュメントセクション管理機能の動作確認手順

> **📋 ステータス**: アクティブ（テスト手順書）  
> **📅 最終更新**: 2025-12-11  
> **👤 用途**: システム設計ドキュメントセクション管理機能の動作確認手順

## 前提条件

- Rustのコンパイルが成功していること
- データベースが初期化されていること
- ChromaDB Serverが起動していること（推奨：埋め込み生成機能を使用する場合）

## 動作確認手順

### 1. アプリケーションの起動

```bash
# 開発モードで起動
npm run dev

# 別のターミナルでTauriアプリを起動
npm run tauri dev
```

### 2. システム設計ページへのアクセス

1. アプリケーションを起動
2. サイドバーから「システム設計」をクリック
3. 「セクション一覧」タブが表示されることを確認

### 3. セクション作成の確認

1. 「セクションを追加」ボタンをクリック
2. モーダルが表示されることを確認
3. 以下の情報を入力：
   - **タイトル**: 「テストセクション」
   - **説明**: 「これはテスト用のセクションです」
   - **内容**: 「このセクションは動作確認のために作成されました。\n\n## サブセクション\n\nここに詳細な内容を記載します。」
   - **タグ**: 「test」「動作確認」（Enterキーで追加）
   - **順序**: 0
   - **セマンティックカテゴリ**: 「test」
   - **キーワード**: 「テスト」「確認」（Enterキーで追加）
   - **要約**: 「動作確認用のテストセクションです」
4. 「作成」ボタンをクリック
5. モーダルが閉じ、セクション一覧に新しいセクションが表示されることを確認

### 4. セクション詳細表示の確認

1. 作成したセクションのカードをクリック
2. セクションの詳細が表示されることを確認：
   - タイトルが表示される
   - 説明が表示される（入力した場合）
   - 要約が表示される（入力した場合）
   - 内容が表示される
   - タグが表示される
   - キーワードが表示される

### 5. セクション編集の確認

1. 作成したセクションの「編集」ボタン（鉛筆アイコン）をクリック
2. モーダルが開き、既存の情報が入力されていることを確認
3. 内容を変更（例：「更新された内容です」）
4. 「更新」ボタンをクリック
5. セクション詳細が更新されることを確認

### 6. セクション削除の確認

1. 作成したセクションの「削除」ボタン（ゴミ箱アイコン）をクリック
2. 確認ダイアログが表示されることを確認
3. 「OK」をクリック
4. セクションが一覧から削除されることを確認

### 7. ChromaDBへの埋め込み生成の確認（オプション）

システム設計ドキュメントセクションは、ChromaDBの`design_docs`コレクションに埋め込みベクトルとして保存されます。

**確認方法**:
1. セクション作成後、自動的に埋め込みが生成される場合があります
2. ブラウザの開発者ツール（F12）でコンソールを確認
3. 以下のログが表示されることを確認：
   ```
   ✅ ChromaDBにシステム設計ドキュメント埋め込みを保存しました: [section-id]
   ```

**手動で埋め込みを生成する場合**:
- システム設計ページで「インデックス」ボタンまたは「埋め込み生成」ボタンをクリック
- すべてのセクションまたは特定のセクションの埋め込みを生成

**注意**: 
- ChromaDBが起動していない場合、埋め込み生成は失敗します
- `design_docs`コレクションは組織ごとではなく、全体で1つのコレクションです

### 8. データベースの確認（オプション）

SQLiteデータベースに正しく保存されているか確認：

```bash
# データベースファイルの場所を確認
# macOSの場合: ~/Library/Application Support/com.missionai.app/mission-ai-local-dev/app.db
# または開発環境のパス

# SQLiteで確認
sqlite3 ~/Library/Application\ Support/com.missionai.app/mission-ai-local-dev/app.db

# テーブル一覧を確認
.tables

# designDocSectionsテーブルの内容を確認
SELECT * FROM designDocSections;

# 終了
.quit
```

### 9. エラーログの確認

ブラウザの開発者ツール（F12）でコンソールエラーがないか確認：

1. 開発者ツールを開く（F12）
2. Consoleタブを確認
3. エラーがないことを確認
4. ChromaDB関連のエラーがないことを確認（埋め込み生成を使用する場合）

## 期待される動作

### 正常な動作

- ✅ セクション作成モーダルが開く
- ✅ セクションが作成され、一覧に表示される
- ✅ セクションをクリックすると詳細が表示される
- ✅ セクション編集モーダルが開き、既存データが表示される
- ✅ セクションが更新される
- ✅ セクションが削除される
- ✅ SQLiteにデータが保存される（`designDocSections`テーブル）
- ✅ ChromaDBに埋め込みベクトルが保存される（`design_docs`コレクション、オプション）

### エラーケースの確認

1. **タイトルなしで作成**: エラーメッセージが表示される
2. **内容なしで作成**: エラーメッセージが表示される
3. **ネットワークエラー**: 適切なエラーメッセージが表示される
4. **ChromaDBが起動していない場合**: 埋め込み生成が失敗するが、セクション作成自体は成功する

## トラブルシューティング

### セクションが表示されない

- ブラウザのコンソールでエラーを確認
- データベースが正しく初期化されているか確認
- ページをリロードしてみる

### モーダルが開かない

- JavaScriptエラーがないか確認
- Reactの状態管理が正しく動作しているか確認

### データが保存されない

- Rust側のコマンドが正しく登録されているか確認
- データベースの権限を確認
- SQLiteのログを確認
- `designDocSections`テーブルが正しく作成されているか確認

### 埋め込みが生成されない

- ChromaDB Serverが起動しているか確認
- ブラウザのコンソールでエラーメッセージを確認
- ChromaDBの接続設定を確認
- `design_docs`コレクションが作成されているか確認

## 実装済みの機能

以下の機能は既に実装済みです：

- ✅ セクション作成・更新・削除
- ✅ セクション一覧表示
- ✅ セクション詳細表示
- ✅ SQLiteへの保存（`designDocSections`テーブル）
- ✅ ChromaDBへの埋め込み生成（`design_docs`コレクション）
- ✅ システム設計ドキュメントのRAG検索（`designDocRAG.ts`）

## 次のステップ

動作確認が完了したら、以下の機能を検討できます：

1. **メタデータ編集UIの改善**: より使いやすいUIの実装
2. **埋め込み生成UIの改善**: バッチ処理や進捗表示の改善
3. **ナレッジグラフ化**: セクション間の関係性の可視化（オプション）

## 関連ドキュメント

- [埋め込みベクトルの保存場所](../database/EMBEDDING_STORAGE_LOCATIONS.md) - 埋め込みベクトルの保存場所の詳細（`design_docs`コレクション）
- [ChromaDB統合計画](../chromadb/CHROMADB_INTEGRATION_PLAN.md) - ChromaDB統合の実装計画
- [ChromaDB使用ガイド](../chromadb/CHROMADB_USAGE_GUIDE.md) - ChromaDBのセットアップとトラブルシューティング
